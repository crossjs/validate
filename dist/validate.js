/*! validate-1.0.0 2014-04-08 00:16:52 */
define("pandora/validate/1.0.0/validate",["$","pandora/widget/1.0.0/widget","pandora/base/1.0.0/base","pandora/class/1.0.0/class","pandora/events/1.0.0/events"],function(a,b,c){"use strict";var d=a("$"),e=a("pandora/widget/1.0.0/widget"),f=function(a){var b={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return a.replace(/&(?:lt|gt|amp|quot|apos);/g,function(a,c){return b[c]})},g=e.extend({defaults:{elements:["select","option",'input[type="checkbox"]','input[type="radio"]',"textarea",'input[type="text"]','input[type="password"]','input[type="file"]'],attributes:["required","pattern","minlength","maxlength","min","max","equalto","minto","maxto","digits","number","url","async"],rules:{required:function(a){var b=a.elem;return/radio|checkbox/.test(b.prop("type"))?a.name?!!this.$('[name="'+a.name+'"]:checked').length:b.is('input[type="checkbox"]'):/\S/.test(a.value)},pattern:function(a){return new RegExp(a.prop).test(a.value)},minlength:function(a){var b=a.value.length;return b?b>=a.prop:!0},maxlength:function(a){var b=a.value.length;return b?b<=a.prop:!0},min:function(a){return parseInt(a.value,10)>=a.prop},max:function(a){return parseInt(a.value,10)<=a.prop},equalto:function(a){return a.value===this.$('[name="'+a.prop+'"]').val()},minto:function(a){return parseInt(a.value,10)>=parseInt(this.$('[name="'+a.prop+'"]').val(),10)},maxto:function(a){return parseInt(a.value,10)<=parseInt(this.$('[name="'+a.prop+'"]').val(),10)},digits:function(a){return!/\D/.test(a.value)},number:function(a){return!isNaN(a.value)},url:function(a){return/^https?:\/\/((?:[\w\d][\w\d\-]*)(?:\.[\w\d][\w\d\-]*)*(?:\.\w{2,})+)(?:\/\S*)?$/i.test(a.value)},async:function(a){return this.pendingCount++,a.prop.call(this,function(b){b?this.pendingCount--:this.addError(a),this.checkValidation()}),"pending"}},messages:{required:"\u6b64\u9879\u5fc5\u586b",pattern:"\u4e0d\u7b26\u5408\u89c4\u5219",minlength:"\u8bf7\u8f93\u5165\u81f3\u5c11{0}\u4e2a\u5b57\u7b26",maxlength:"\u6700\u591a\u8f93\u5165{0}\u4e2a\u5b57\u7b26",min:"\u4e0d\u80fd\u5c0f\u4e8e{0}",max:"\u4e0d\u80fd\u5927\u4e8e{0}",equalto:"\u4e24\u6b21\u8f93\u5165\u7684\u5185\u5bb9\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165",minto:"\u4e0d\u80fd\u5c0f\u4e8e{0}",maxto:"\u4e0d\u80fd\u5927\u4e8e{0}",digits:"\u8bf7\u8f93\u5165\u6570\u5b57",number:"\u8bf7\u8f93\u5165\u6570\u5b57",url:"\u8bf7\u8f93\u5165URL\u5730\u5740",async:"\u5f02\u6b65\u6821\u9a8c\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5"},customRules:{},delegates:function(){var a={submit:function(a){a.preventDefault(),this.data("submitted")?this.checkValidation():this.validateForm()}},b=this.option("eventType");return b&&(b+=" "+this.option("elements").join(","),a[b]=function(a){console.log(arguments),this.validateElem(d(a.currentTarget))}),a},events:{valid:function(){this.element.submit()}}},setup:function(){this.state(g.STATE.INITIAL),this.pendingCount=0,this.errorElements=d(),this.element.attr({novalidate:"novalidate"})},validateForm:function(){var a=this;this.errorElements=d(),this.data("submitted",!0),this.$(this.option("elements").join(",")).filter(":enabled").each(function(){a.validateElem(d(this))}),this.checkValidation()},validateElem:function(a){var b,c=!0,e={elem:a,name:a.prop("name"),value:a.val()};this.removeError(e),d.each(this.option("attributes"),d.proxy(function(b,f){var g=a.attr(f);return void 0!==g&&null!==g&&""!==g?c=this.checkRule(d.extend({rule:f,prop:isNaN(g)?g:+g},e)):void 0},this)),c!==!1&&(b=this.option(["customRules",e.name].join("/")))&&d.each(b,d.proxy(function(a,b){return this.checkRule(d.extend({rule:a,prop:isNaN(b)?b:+b},e))},this))},checkRule:function(a){var b,c=this.option(["rules",a.rule].join("/"));return c?b=c.call(this,a):"function"==typeof a.prop&&(b=a.prop.call(this,a)),b===!1&&this.addError(a),b},checkValidation:function(){return this.errorElements.length>0?(this.state(g.STATE.ERROR),this.data("submitted",!1),this.focusError(),this.fire("error")):this.pendingCount<=0?(this.state(g.STATE.VALID),this.data("submitted",!1),this.fire("valid")):void this.state(g.STATE.PENDING)},clearErrors:function(){var a=this;this.$(this.option("elements").join(",")).filter(":enabled").each(function(){a.removeError({elem:d(this)})})},focusError:function(){this.errorElements.length&&this.errorElements.eq(0).focus()},addError:function(a,b){var c=a.elem,e=c.data("wrap"),f=c.data("help");e||(e=c.closest(".form-group"),c.data("wrap",e)),f||(f=e.find(".help-block"),0===f.length&&(f=d('<div class="help-block"/>').appendTo(e)),c.data("help",f)),e.addClass("has-error"),f.text(b||this.getMessage(a)),this.errorElements=this.errorElements.add(c)},getMessage:function(a){var b=this.option(["customMessages",a.name,a.rule].join("/"))||this.option(["messages",a.name,a.rule].join("/"))||this.option(["messages",a.rule].join("/"));return b?b.replace(/\{0\}/g,a.prop):""},removeError:function(a){var b,c=a.elem,e=c.data("wrap"),g=c.data("help");e||(e=c.closest(".form-group"),c.data("wrap",e)),g||(g=e.find(".help-block"),0===g.length&&(g=d('<div class="help-block"/>').appendTo(e)),c.data("help",g)),e.removeClass("has-error"),b=g.data("placeholder"),b?g.html(f(b)):g.empty(),this.errorElements=this.errorElements.not(c)}});g.addRule=function(a){d.extend(!0,g.prototype.defaults.rules,a)},g.STATE={INITIAL:-1,ERROR:0,VALID:1,PENDING:2},c.exports=g});